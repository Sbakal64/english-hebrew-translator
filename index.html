<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Multi-Endpoint Free Translator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        function App() {
            const [inputText, setInputText] = React.useState('');
            const [translatedText, setTranslatedText] = React.useState('');
            const [isLoading, setIsLoading] = React.useState(false);
            const [error, setError] = React.useState(null);
            const [translationHistory, setTranslationHistory] = React.useState([]);

            // Free translation API endpoints
            const FREE_TRANSLATION_ENDPOINTS = [
                'https://libretranslate.de/translate',
                'https://translate.argocd.sdragonfruit.xyz/translate',
                'https://translate.terraprint.co/translate'
            ];

            // Attempt translation with multiple endpoints
            const multiEndpointTranslate = async (text) => {
                for (let endpoint of FREE_TRANSLATION_ENDPOINTS) {
                    try {
                        const response = await axios.post(endpoint, {
                            q: text,
                            source: 'en',
                            target: 'he'
                        });

                        // Validate translation
                        if (response.data.translatedText && response.data.translatedText.trim() !== '') {
                            return response.data.translatedText;
                        }
                    } catch (error) {
                        console.warn(`Translation failed with endpoint: ${endpoint}`, error);
                    }
                }
                throw new Error('All translation endpoints failed');
            };

            // Debounced translation function
            const debouncedTranslate = React.useCallback(
                _.debounce(async (text) => {
                    if (!text.trim()) {
                        setError('Please enter some text to translate');
                        return;
                    }

                    setIsLoading(true);
                    setError(null);

                    try {
                        const translatedResult = await multiEndpointTranslate(text);
                        setTranslatedText(translatedResult);

                        // Save to translation history
                        const newHistoryEntry = {
                            original: text,
                            translation: translatedResult,
                            timestamp: new Date().toLocaleString()
                        };
                        setTranslationHistory(prev => [newHistoryEntry, ...prev].slice(0, 10));
                    } catch (err) {
                        setError('Translation failed. All services are down. Please try again later.');
                        console.error(err);
                    } finally {
                        setIsLoading(false);
                    }
                }, 500),
                []
            );

            React.useEffect(() => {
                if (inputText) {
                    debouncedTranslate(inputText);
                }
            }, [inputText, debouncedTranslate]);

            const copyToClipboard = (text) => {
                navigator.clipboard.writeText(text).then(() => {
                    alert('Copied to clipboard!');
                });
            };

            return (
                <div className="container mx-auto p-6 max-w-4xl">
                    <h1 className="text-3xl font-bold mb-6 text-center">Multi-Endpoint Translator</h1>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label htmlFor="input-text" className="block mb-2 font-semibold">English Text</label>
                            <textarea 
                                id="input-text"
                                value={inputText}
                                onChange={(e) => setInputText(e.target.value)}
                                className="w-full h-64 p-3 border rounded-lg"
                                placeholder="Enter text to translate..."
                            />
                        </div>
                        
                        <div>
                            <label htmlFor="translated-text" className="block mb-2 font-semibold">Hebrew Translation</label>
                            <div className="relative">
                                <textarea 
                                    id="translated-text"
                                    value={translatedText}
                                    readOnly
                                    className="w-full h-64 p-3 border rounded-lg bg-gray-100"
                                    placeholder="Translation will appear here..."
                                />
                                <button 
                                    onClick={() => copyToClipboard(translatedText)}
                                    className="absolute top-2 right-2 bg-blue-500 text-white px-3 py-1 rounded"
                                >
                                    Copy
                                </button>
                            </div>
                        </div>
                    </div>

                    {error && (
                        <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mt-4" role="alert">
                            {error}
                        </div>
                    )}

                    <div className="mt-6">
                        <h2 className="text-xl font-semibold mb-4">Translation History</h2>
                        <div className="grid gap-2">
                            {translationHistory.map((entry, index) => (
                                <div key={index} className="bg-gray-100 p-3 rounded">
                                    <p className="font-bold">Original: {entry.original}</p>
                                    <p>Translation: {entry.translation}</p>
                                    <p className="text-sm text-gray-500">{entry.timestamp}</p>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
