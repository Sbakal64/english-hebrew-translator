<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced English-Hebrew Translator</title>
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        function App() {
            const [inputText, setInputText] = React.useState('');
            const [translatedText, setTranslatedText] = React.useState('');
            const [isLoading, setIsLoading] = React.useState(false);
            const [error, setError] = React.useState(null);
            const [translationHistory, setTranslationHistory] = React.useState([]);
            const [apiUsed, setApiUsed] = React.useState('');

            // Expanded dictionary with common phrases, idioms, and slang
            const ENGLISH_HEBREW_DICTIONARY = {
                // Basic phrases
                "hello": "שלום",
                "goodbye": "להתראות",
                "thank you": "תודה",
                "please": "בבקשה",
                "sorry": "סליחה",
                "excuse me": "סליחה",
                "how are you": "מה שלומך",
                "what's up": "מה קורה",
                "good morning": "בוקר טוב",
                "good night": "לילה טוב",
                "I love you": "אני אוהב אותך",
                "my name is": "קוראים לי",
                "where is": "איפה נמצא",
                "how much does it cost": "כמה זה עולה",
                "I don't understand": "אני לא מבין",
                "do you speak english": "אתה מדבר אנגלית",
                
                // Common idioms
                "break a leg": "בהצלחה",
                "piece of cake": "קלי קלות",
                "hit the books": "ללמוד",
                "let the cat out of the bag": "גילה את הסוד",
                "when pigs fly": "כשיהיה שלג בתל אביב",
                "costs an arm and a leg": "עולה הון תועפות",
                "kill two birds with one stone": "להרוג שתי ציפורים במכה אחת",
                "the best of both worlds": "הטוב משני העולמות",
                "speak of the devil": "מדבר עליו והוא מופיע",
                "see eye to eye": "מסכימים",
                "once in a blue moon": "פעם בכמה זמן",
                "the ball is in your court": "הכדור במגרש שלך",
                "you can't judge a book by its cover": "אל תסתכל בקנקן אלא במה שיש בו",
                
                // Slang and colloquial
                "what's the catch": "מה המלכוד",
                "that's lit": "זה מטורף",
                "I'm broke": "אני מרושש",
                "chill out": "תירגע",
                "no way": "אין מצב",
                "that's awesome": "זה מדהים",
                "that sucks": "זה גרוע",
                "I'm down": "אני בפנים",
                "bail on someone": "לנשור על מישהו",
                "ghost someone": "להעלים את עצמך ממישהו",
                "hang out": "להסתובב",
                "my bad": "טעות שלי",
                "you rock": "אתה אלוף",
                "that's sketchy": "זה חשוד",
                "throw shade": "לזלזל",
                "wasted": "שתוי",
                "yolo": "חיים רק פעם אחת",
                
                // Tech terms
                "download": "להוריד",
                "upload": "להעלות",
                "username": "שם משתמש",
                "password": "סיסמה",
                "click here": "לחץ כאן",
                "sign up": "להירשם",
                "log in": "להתחבר",
                "homepage": "דף הבית",
                "settings": "הגדרות",
                "notifications": "התראות",
                
                // Business phrases
                "let's touch base": "בואו נעדכן",
                "thinking outside the box": "חשיבה מחוץ לקופסה",
                "circle back": "לחזור לנושא",
                "move the needle": "לגרום לשינוי",
                "low hanging fruit": "פירות תלויים נמוך",
                "win-win situation": "מצב של win-win",
                "bring to the table": "להביא לשולחן",
                "on the same page": "על אותו הדף",
                "deep dive": "צלילה עמוקה",
                "game changer": "משנה משחק",
                
                // Travel phrases
                "where is the bathroom": "איפה השירותים",
                "how do I get to": "איך מגיעים ל",
                "how much is a ticket to": "כמה עולה כרטיס ל",
                "I would like to order": "אני רוצה להזמין",
                "check please": "חשבון בבקשה",
                "do you have wifi": "יש לכם וויי-פיי",
                "what time does it open": "באיזו שעה זה נפתח",
                "what time does it close": "באיזו שעה זה נסגר",
                "is there a discount": "יש הנחה",
                
                // Medical terms
                "I don't feel well": "אני לא מרגיש טוב",
                "I need a doctor": "אני צריך רופא",
                "where is the hospital": "איפה בית החולים",
                "I'm allergic to": "אני אלרגי ל",
                "it hurts here": "כואב לי כאן",
                "fever": "חום",
                "headache": "כאב ראש",
                "stomach ache": "כאב בטן",
                "sore throat": "גרון כואב",
                "pharmacy": "בית מרקחת"
            };

            // Free translation API endpoints
            const FREE_TRANSLATION_ENDPOINTS = [
                {
                    name: "LibreTranslate",
                    url: "https://libretranslate.de/translate",
                    method: "POST",
                    data: (text) => ({
                        q: text,
                        source: 'en',
                        target: 'he',
                        format: 'text'
                    }),
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    extract: (res) => res.data.translatedText
                },
                {
                    name: "MyMemory",
                    url: "https://api.mymemory.translated.net/get",
                    method: "GET",
                    params: (text) => ({
                        q: text,
                        langpair: 'en|he',
                        de: 'example@example.com'
                    }),
                    extract: (res) => res.data.responseData.translatedText
                }
            ];

            // Local translation function
            const localTranslate = (text) => {
                // First check exact matches
                const lowerText = text.toLowerCase().trim();
                if (ENGLISH_HEBREW_DICTIONARY[lowerText]) {
                    return ENGLISH_HEBREW_DICTIONARY[lowerText];
                }

                // Then check for partial matches (phrases within sentences)
                for (const [phrase, translation] of Object.entries(ENGLISH_HEBREW_DICTIONARY)) {
                    if (lowerText.includes(phrase)) {
                        return translation;
                    }
                }

                return null;
            };

            // Attempt translation with multiple endpoints
            const multiEndpointTranslate = async (text) => {
                // First try local dictionary
                const localTranslation = localTranslate(text);
                if (localTranslation) {
                    setApiUsed("Local Dictionary");
                    return localTranslation;
                }

                // Then try other APIs
                for (let endpoint of FREE_TRANSLATION_ENDPOINTS) {
                    try {
                        let response;
                        if (endpoint.method === "GET") {
                            response = await axios.get(endpoint.url, {
                                params: endpoint.params(text)
                            });
                        } else {
                            response = await axios({
                                method: endpoint.method || "POST",
                                url: endpoint.url,
                                data: endpoint.data(text),
                                headers: endpoint.headers
                            });
                        }

                        const translatedText = endpoint.extract(response);
                        
                        // Validate translation
                        if (translatedText && translatedText.trim() !== '') {
                            setApiUsed(endpoint.name);
                            return translatedText;
                        }
                    } catch (error) {
                        console.warn(`Translation failed with ${endpoint.name}:`, error);
                    }
                }
                throw new Error('All translation services failed. Try a shorter text or different phrasing.');
            };

            // Rest of the code remains the same as previous version...
            // [Previous implementation of debouncedTranslate, useEffect, copyToClipboard, and render method]
            
            const debouncedTranslate = React.useCallback(
                _.debounce(async (text) => {
                    if (!text.trim()) {
                        setTranslatedText('');
                        setError(null);
                        setApiUsed('');
                        return;
                    }

                    setIsLoading(true);
                    setError(null);
                    setApiUsed('');

                    try {
                        const translatedResult = await multiEndpointTranslate(text);
                        setTranslatedText(translatedResult);

                        // Save to translation history
                        const newHistoryEntry = {
                            original: text,
                            translation: translatedResult,
                            timestamp: new Date().toLocaleString(),
                            api: apiUsed
                        };
                        setTranslationHistory(prev => [newHistoryEntry, ...prev].slice(0, 10));
                    } catch (err) {
                        setError(err.message);
                        console.error(err);
                    } finally {
                        setIsLoading(false);
                    }
                }, 500),
                []
            );

            React.useEffect(() => {
                if (inputText) {
                    debouncedTranslate(inputText);
                } else {
                    setTranslatedText('');
                    setApiUsed('');
                }
            }, [inputText, debouncedTranslate]);

            const copyToClipboard = (text) => {
                if (!text) return;
                navigator.clipboard.writeText(text).then(() => {
                    alert('Copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy:', err);
                });
            };

            return (
                <div className="container mx-auto p-4 md:p-6 max-w-4xl">
                    <h1 className="text-3xl font-bold mb-6 text-center">Advanced English-Hebrew Translator</h1>
                    <p className="text-center mb-6 text-gray-600">For accurate translations of phrases, idioms, and slang</p>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label htmlFor="input-text" className="block mb-2 font-semibold">English Text</label>
                            <textarea 
                                id="input-text"
                                value={inputText}
                                onChange={(e) => setInputText(e.target.value)}
                                className="w-full h-64 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="Enter text to translate..."
                                disabled={isLoading}
                            />
                            {isLoading && (
                                <div className="mt-2 text-blue-600">Translating...</div>
                            )}
                        </div>
                        
                        <div>
                            <label htmlFor="translated-text" className="block mb-2 font-semibold">Hebrew Translation</label>
                            <div className="relative">
                                <textarea 
                                    id="translated-text"
                                    value={translatedText}
                                    readOnly
                                    className="w-full h-64 p-3 border rounded-lg bg-gray-50"
                                    placeholder="Translation will appear here..."
                                    dir="rtl"
                                />
                                {translatedText && (
                                    <button 
                                        onClick={() => copyToClipboard(translatedText)}
                                        className="absolute top-2 right-2 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded transition"
                                        title="Copy to clipboard"
                                    >
                                        Copy
                                    </button>
                                )}
                                {apiUsed && (
                                    <div className="absolute bottom-2 left-2 text-xs text-gray-500">
                                        Translated via: {apiUsed}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {error && (
                        <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mt-4" role="alert">
                            <strong>Error:</strong> {error}
                            <p className="mt-1 text-sm">Try simpler text or check back later if services are down.</p>
                        </div>
                    )}

                    {translationHistory.length > 0 && (
                        <div className="mt-6">
                            <h2 className="text-xl font-semibold mb-4">Translation History</h2>
                            <div className="grid gap-2">
                                {translationHistory.map((entry, index) => (
                                    <div key={index} className="bg-gray-50 p-3 rounded border">
                                        <p className="font-bold">Original: {entry.original}</p>
                                        <p>Translation: <span dir="rtl" className="inline-block">{entry.translation}</span></p>
                                        <p className="text-sm text-gray-500">
                                            {entry.timestamp} • Via: {entry.api || 'Unknown'}
                                        </p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    <div className="mt-8 p-4 bg-blue-50 rounded-lg">
                        <h3 className="font-semibold text-lg mb-2">About This Translator</h3>
                        <p className="text-gray-700 mb-2">
                            This translator combines a comprehensive local dictionary with multiple translation APIs to provide 
                            the most accurate Hebrew translations for phrases, idioms, and slang.
                        </p>
                        <p className="text-gray-700">
                            The dictionary contains {Object.keys(ENGLISH_HEBREW_DICTIONARY).length} pre-defined translations 
                            for common expressions.
                        </p>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
